<!DOCTYPE html>
<html lang="fr">
<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <style>
        .chart{
            padding: 2rem;
        }

        .chartstyle{
            display:flex;
            justify-content:center;
            min-height: 100vh;
        }
        .navbar {
            background-color: gray; /* Couleur de fond de la navbar */
            color: white; /* Couleur du texte */
            padding: 10px; /* Espacement interne */
            position: fixed; /* Position fixe pour rester au sommet */
            top: 0; /* Collé en haut */
            right: 0; /* Collé à droite */
            border-bottom-left-radius: 10px; /* Arrondi du coin inférieur gauche */
            text-decoration: none;
        }

        /* Style pour l'enseigne */
        .brand {
            font-size: 1.5rem; /* Taille de police plus grande */
            font-weight: bold; /* Texte en gras */
            margin-right: auto; /* Pousser vers la droite autant que possible */
        }
    </style>
</head>
<a href="/submit_feedback" class="navbar">
    <!-- Barre de navigation -->
    <nav>
        <span class="brand">Accueil</span> <!-- Enseigne -->
        <!-- Liens de navigation (vous pouvez ajouter des liens ici si nécessaire) -->
    </nav>
</a>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>

<form method="GET" >
    <select name="period" id="period-select">
        <option value="aujourd_hui">Aujourd'hui</option>
        <option value="hier">Hier</option>
        <option value="7_derniers_jours">Les 7 derniers jours</option>
        <option value="30_derniers_jours">Les 30 derniers jours</option>
        <option value="365_derniers_jours">Les 365 derniers jours</option>
        <option value="personnalisé">Personnalisé</option>
    </select>
    <input type="date" name="start_date" id="start-date" style="display: none;">
    <input type="date" name="end_date" id="end-date" style="display: none;">
    <input type="submit" value="Afficher">
</form>


<section class="bg-white p-5 m-3 rounded">
    <h4 class="text-xl">Statistiques de satisfaction</h4>
    <div class="flex flex-col lg:flex-row items-center gap-5 mt-5">
        

        <div class="flex justify-evenly items-center w-96 lg:w-1/3 p-3 m-3 border border-gray-300 rounded">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="#ff000b" class="text-red-300 w-20 h-20">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.182 16.318A4.486 4.486 0 0012.016 15a4.486 4.486 0 00-3.198 1.318M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75zm-.375 0h.008v.015h-.008V9.75zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75zm-.375 0h.008v.015h-.008V9.75z" />
            </svg>
            <div class="text-center">
                <h4 class="inline text-gray-500 text-md">Très mauvais</h4>
            </div>
        </div>
        
        <div class="flex justify-evenly items-center w-96 lg:w-1/3 p-3 m-3 border border-gray-300 rounded">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="#ff8300" class="text-gray-400 w-20 h-20">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.182 15.182a25.5 4.5 0 01-6.364 0M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75zm-.375 0h.008v.015h-.008V9.75zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75zm-.375 0h.008v.015h-.008V9.75z" />
            </svg>
            <div class="text-center">
                
                <h4 class="inline text-gray-500 text-md">Mauvais</h4>
            </div>
        </div>
        
        <div class="flex justify-evenly items-center w-96 lg:w-1/3 p-3 m-3 border border-gray-300 rounded">
            <svg xmlns="http://www.w3.org/2000/svg"  fill="none" viewBox="0 0 24 24"
                stroke-width="1.5" stroke="#65d830" class="text-gray-400 w-20 h-20">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M15.182 15.182a25.5 4.5 0 01-6.364 0M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75zm-.375 0h.008v.015h-.008V9.75zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75zm-.375 0h.008v.015h-.008V9.75z" />
            </svg>
            <div class="text-center">
    
                <h4 class="inline text-gray-500 text-md">Satisfaisant</h4>
            </div>
        </div>

        <div class="flex justify-evenly items-center w-96 lg:w-1/3 p-3 m-3 border border-gray-300 rounded">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="#00bb47" class="text-green-400 w-20 h-20">
                <path stroke-linecap="round" stroke-linejoin="round"   
                    d="M15.182 15.182a4.5 4.5 0 01-6.364 0M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75zm-.375 0h.008v.015h-.008V9.75zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75zm-.375 0h.008v.015h-.008V9.75z" />
            </svg>
            <div class="text-center">
                <h4 class="inline text-gray-500 text-md">Très satisfaisant</h4>
            </div>
        </div>

    </div>
</section>
<div class="chartstyle">
    <div class="chart">
        <canvas id="myChart" data-bad-count="{{ bad_count }}" ></canvas>
    </div>
</div>


<script>
    document.getElementById('period-select').addEventListener('change', function() {
        var customFields = document.querySelectorAll('#start-date, #end-date');
        if (this.value === 'personnalisé') {
            customFields.forEach(function(field) {
                field.style.display = 'inline-block';
            });
        } else {
            customFields.forEach(function(field) {
                field.style.display = 'none';
            });
        }
    });
</script>
<script>

    var emojiStats = [
        {% for item in emoji_stats %}
            {
                emoji: "{{ item.emoji }}",
                count: {{ item.count }}
            }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];

    // Déclaration des variables pour les totaux de chaque emoji
    var veryBadCount = 0;
    var badCount = 0;
    var happyCount = 0;
    var veryHappyCount = 0;

    // Calcul des totaux pour chaque type d'emoji
    emojiStats.forEach(function(item) {
        switch(item.emoji) {
            case 'very bad':
                veryBadCount += item.count;
                break;
            case 'bad':
                badCount += item.count;
                break;
            case 'happy':
                happyCount += item.count;
                break;
            case 'very happy':
                veryHappyCount += item.count;
                break;
            // Ajoutez d'autres cas si nécessaire pour d'autres types d'emoji
        }
    });

    // Utilisation des totaux dans le script JavaScript
    console.log("Very Bad Count:", veryBadCount);
    console.log("Bad Count:", badCount);
    console.log("Happy Count:", happyCount);
    console.log("Very Happy Count:", veryHappyCount);
    const ctx = document.getElementById('myChart');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Très mauvais', 'Mauvais', 'Satisfaisant', 'Très satisfaisant'],
                        datasets: [{
                            label: 'Stats de satisfaction',
                            data: [veryBadCount, badCount, happyCount, veryHappyCount], // Utilisation de veryBadCount ici
                            backgroundColor: ['#ff000b', '#ff8300', '#65d830', '#00bb47'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        // Options du graphique
                    }
                });
    
    </script>
